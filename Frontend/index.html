<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Party Games Hub</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, sans-serif; text-align: center; margin-top: 30px; background: #f9f9f9; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        button { padding: 12px 24px; margin: 10px; border: none; border-radius: 5px; background: #007bff; color: white; cursor: pointer; font-size: 16px; width: 80%; }
        button:hover { background: #0056b3; }
        input, select { padding: 12px; margin: 10px; width: 80%; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 10px; background: #eee; margin: 5px; border-radius: 5px; }
        .dead { color: red; text-decoration: line-through; }
    </style>
</head>
<body>

<div class="container" id="login-screen">
    <h2>üéÆ Party Games Hub</h2>
    <input type="text" id="player-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
    <input type="text" id="room-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á">
    <button onclick="joinRoom()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
</div>

<div class="container hidden" id="lobby-screen">
    <h2>‡∏´‡πâ‡∏≠‡∏á: <span id="display-room-id" style="color:#007bff;"></span></h2>
    <h3>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á:</h3>
    <ul id="player-list"></ul>
    
    <div id="host-controls" class="hidden">
        <hr>
        <h3>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Host)</h3>
        <select id="game-select">
            <option value="mr_white">Mr. White üïµÔ∏è</option>
            <option value="werewolf">Werewolf üê∫</option>
            <option value="level_game">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏ô ‡πÉ‡∏Ñ‡∏£‡∏ô‡πâ‡∏≤‡∏≤ üßê</option>
        </select>
        <br>
        <select id="mr-white-category">
            <option value="‡∏ú‡∏•‡πÑ‡∏°‡πâ">‡∏ú‡∏•‡πÑ‡∏°‡πâ</option>
            <option value="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
            <option value="‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á">‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á</option>
            <option value="‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡πå‡∏î‡∏±‡∏á">‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡πå‡∏î‡∏±‡∏á</option>
        </select>
        <br>
        <button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
    </div>
</div>

<div class="container hidden" id="game-screen">
    <h2 id="game-title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>
    <div id="game-content"></div>
</div>

<script>
    let ws;
    let myName;
    let myRoom;
    let hostName;
    
    // Game Variables
    let countdownInterval;
    let myRoleWerewolf = "";
    let alivePlayers = [];
    let wolvesList = [];
    let currentPlayersToMatch = [];

    function joinRoom() {
        myName = document.getElementById('player-name').value;
        myRoom = document.getElementById('room-id').value;
        if (!myName || !myRoom) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á!");

        // ==========================================
        // [‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ß‡∏•‡∏≤ Deploy ‡∏à‡∏£‡∏¥‡∏á]
        // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: wss://your-backend.onrender.com/ws/
        // ==========================================
        ws = new WebSocket(`wss://webapp-1moo.onrender.com`);

        ws.onmessage = function(event) {
            const msg = JSON.parse(event.data);
            
            switch(msg.type) {
                case "update_lobby": updateLobby(msg.room); break;
                case "game_started": handleGameStart(msg); break;
                case "start_voting": startVotingUI(msg); break;
                case "werewolf_night": handleWerewolfNightStart(msg); break;
                case "vote_result": showVoteResult(msg); break;
                case "werewolf_morning": handleWerewolfMorning(msg); break;
                case "level_game_started": renderLevelGameInput(msg); break;
                case "level_word_refreshed": updateLevelWord(msg.word); break;
                case "start_level_matching": renderLevelMatching(msg); break;
                case "level_game_result": renderLevelResult(msg); break;
            }
        };

        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('lobby-screen').classList.remove('hidden');
        document.getElementById('display-room-id').innerText = myRoom;
    }

    function updateLobby(roomData) {
        const wasHost = (myName === hostName);
        hostName = roomData.host;
        const isNowHost = (myName === hostName);

        // [Fix #4] Notify new host while in-game
        if (!wasHost && isNowHost) {
            const gameScreen = document.getElementById('game-screen');
            if (!gameScreen.classList.contains('hidden')) {
                const notice = document.createElement('div');
                notice.style.cssText = 'background:#fff3cd;padding:10px;border-radius:5px;margin:10px 0;font-weight:bold;';
                notice.innerText = 'üëë Host ‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô Host! ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
                document.getElementById('game-content').prepend(notice);
            }
        }

        const list = document.getElementById('player-list');
        list.innerHTML = "";
        roomData.players.forEach(p => {
            const li = document.createElement('li');
            li.innerText = p + (p === hostName ? " üëë" : "");
            list.appendChild(li);
        });

        if (myName === hostName) {
            document.getElementById('host-controls').classList.remove('hidden');
        }
    }

    function startGame() {
        const game = document.getElementById('game-select').value;
        if (game === "mr_white") {
            const category = document.getElementById('mr-white-category').value;
            ws.send(JSON.stringify({ action: "start_mr_white", category: category }));
        } else if (game === "werewolf") {
            ws.send(JSON.stringify({ action: "start_werewolf" }));
        } else if (game === "level_game") {
            ws.send(JSON.stringify({ action: "start_level_game" }));
        }
    }

    function resetToLobby() {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('lobby-screen').classList.remove('hidden');
    }

    // --- MR. WHITE & VOTING LOGIC ---
    function handleGameStart(msg) {
        document.getElementById('lobby-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        
        if (msg.game === "mr_white") {
            document.getElementById('game-title').innerText = "‡πÄ‡∏Å‡∏°: Mr. White üïµÔ∏è";
            const myRole = msg.data.roles[myName];
            let myWord = myRole === "team_a" ? msg.data.words[0] : (myRole === "team_b" ? msg.data.words[1] : "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Mr. White!");
            
            document.getElementById('game-content').innerHTML = `
                <h3>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: <br><span style="color:red; font-size:1.5em;">${myWord}</span></h3>
                <button onclick="readyUp()">Ready (‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå)</button>
            `;
        } else if (msg.game === "werewolf") {
            document.getElementById('game-title').innerText = "‡πÄ‡∏Å‡∏°: Werewolf üê∫";
            myRoleWerewolf = msg.data.roles[myName];
            alivePlayers = msg.data.alive;
            wolvesList = msg.data.wolves;
            renderWerewolfNight();
        }
    }

    function readyUp() {
        let html = `<h3>‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï... ‚è≥</h3>`;
        if (myName === hostName) {
            html += `<button onclick="ws.send(JSON.stringify({action: 'trigger_vote'}))">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏ß‡∏ï 1 ‡∏ô‡∏≤‡∏ó‡∏µ (Host)</button>`;
        }
        document.getElementById('game-content').innerHTML = html;
    }

    function startVotingUI(msg) {
        let timeLeft = msg.time;
        let voteHtml = `<h3 style="color:red;">‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏ß‡∏ï: <span id="timer">${timeLeft}</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</h3><div id="vote-buttons">`;

        msg.alive_players.forEach(p => {
            if (p !== myName) voteHtml += `<button onclick="castVote('${p}')">‡πÇ‡∏´‡∏ß‡∏ï ${p}</button>`;
        });
        voteHtml += `</div>`;
        document.getElementById('game-content').innerHTML = voteHtml;

        countdownInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                document.getElementById('vote-buttons').innerHTML = "<p>‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏ß‡∏ï ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏ú‡∏•...</p>";
            }
        }, 1000);
    }

    function castVote(targetPlayer) {
        ws.send(JSON.stringify({ action: "vote", target: targetPlayer }));
        document.getElementById('vote-buttons').innerHTML = `<h4>‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏´‡∏ß‡∏ï ${targetPlayer} ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ú‡∏•...</h4>`;
    }

    function showVoteResult(msg) {
        clearInterval(countdownInterval);
        if (msg.alive) alivePlayers = msg.alive;

        let html = `<h2>${msg.message}</h2>`;
        if (msg.eliminated.length === 0) {
            html += `<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ï‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ!</p>`;
        } else {
            html += `<h3>‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å üíÄ:</h3><ul style="text-align:left;">`;
            msg.eliminated.forEach(p => {
                let teamName = "";
                if (msg.game === "werewolf") {
                    teamName = p.team === "werewolf" ? "‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤ üê∫" : "‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô üßë‚Äçüåæ";
                } else {
                    teamName = p.team === "mr_white" ? "Mr. White üïµÔ∏è" : (p.team === "team_a" ? "‡∏ó‡∏µ‡∏° A üî¥" : "‡∏ó‡∏µ‡∏° B üîµ");
                }
                html += `<li><b>${p.name}</b> (${teamName})</li>`;
            });
            html += `</ul>`;
        }

        if (msg.winner) {
            html += `<hr><h1 style="color:green;">üèÜ ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞: ${msg.winner}</h1>`;
            html += `<button onclick="resetToLobby()">‡∏Å‡∏•‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ</button>`;
        } else if (msg.game === "werewolf") {
            html += `<hr>`;
            if (myName === hostName) {
                html += `<button onclick="startWerewolfNight()">üåô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà (Host)</button>`;
            } else {
                html += `<p>‡∏£‡∏≠ Host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô...</p>`;
            }
        } else {
            html += `<hr>`;
            if (myName === hostName) {
                html += `<button onclick="ws.send(JSON.stringify({action: 'trigger_vote'}))">üó≥Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (Host)</button>`;
            } else {
                html += `<p>‡∏£‡∏≠ Host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...</p>`;
            }
        }
        document.getElementById('game-content').innerHTML = html;
    }

    // --- WEREWOLF LOGIC ---
    function renderWerewolfNight() {
        let isWolf = myRoleWerewolf === "werewolf";
        let html = `<h3>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ${isWolf ? "<span style='color:red;'>‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤ üê∫</span>" : "<span style='color:blue;'>‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô üßë‚Äçüåæ</span>"}</h3>`;
        html += `<p>üåô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ)</p><div>`;
        
        alivePlayers.forEach(p => {
            if (p !== myName) {
                let icon = (isWolf && wolvesList.includes(p)) ? " üê∫" : "";
                html += `<button onclick="sendNightAction('${p}')">${p}${icon}</button>`;
            }
        });
        html += `</div>`;
        document.getElementById('game-content').innerHTML = html;
    }

    function sendNightAction(targetPlayer) {
        ws.send(JSON.stringify({ action: "werewolf_night_action", target: targetPlayer }));
        document.getElementById('game-content').innerHTML = `<h3>‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏ï‡∏≤... üò¥</h3>`;
    }

    function handleWerewolfNightStart(msg) {
        alivePlayers = msg.alive;
        renderWerewolfNight();
    }

    function startWerewolfNight() {
        ws.send(JSON.stringify({ action: "start_werewolf_night" }));
    }

    function handleWerewolfMorning(msg) {
        alivePlayers = msg.alive;
        let html = `<h2>‚òÄÔ∏è ‡πÄ‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!</h2>`;
        if (msg.killed) {
            html += `<h3 style="color:red;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô ${msg.killed} ‡∏ñ‡∏π‡∏Å‡∏Ü‡πà‡∏≤‡∏ï‡∏≤‡∏¢ ü©∏</h3>`;
            if (msg.killed === myName) html += `<p>‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì üëª ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏π‡∏î!</p>`;
        } else {
            html += `<h3>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ï‡∏≤‡∏¢ üïäÔ∏è</h3>`;
        }

        if (msg.winner) {
            html += `<hr><h1 style="color:green;">‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞: ${msg.winner} üéâ</h1>`;
            html += `<button onclick="resetToLobby()">‡∏Å‡∏•‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ</button>`;
        } else {
            html += `<hr><p>‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤!</p>`;
            if (myName === hostName) {
               html += `<button onclick="ws.send(JSON.stringify({action: 'trigger_vote'}))">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï (60 ‡∏ß‡∏¥)</button>`;
            }
        }
        document.getElementById('game-content').innerHTML = html;
    }

    // --- LEVEL GAME LOGIC ---
    function renderLevelGameInput(msg) {
        document.getElementById('lobby-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('game-title').innerText = "‡πÄ‡∏Å‡∏°: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏ô ‡πÉ‡∏Ñ‡∏£‡∏ô‡πâ‡∏≤‡∏≤ üßê";
        
        let html = `<h3>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: <br><span id="level-word" style="color: purple; font-size: 1.5em;">${msg.word}</span></h3>`;
        if (myName === msg.host) html += `<button onclick="ws.send(JSON.stringify({action: 'refresh_level_word'}))">üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥</button><br><br>`;
        
        html += `<p>‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (1-100):</p>`;
        html += `<input type="number" id="my-level-number" min="1" max="100" placeholder="1-100"><br>`;
        html += `<button onclick="submitLevelNumber()">Ready</button>`;
        document.getElementById('game-content').innerHTML = html;
    }

    function updateLevelWord(word) {
        const el = document.getElementById('level-word');
        if(el) el.innerText = word;
    }

    function submitLevelNumber() {
        const num = document.getElementById('my-level-number').value;
        if (num < 1 || num > 100) return alert("‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 1-100 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
        ws.send(JSON.stringify({ action: "submit_level_number", number: num }));
        document.getElementById('game-content').innerHTML = `<h3>‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç... ‚è≥</h3>`;
    }

    function renderLevelMatching(msg) {
        currentPlayersToMatch = msg.players;
        let html = `<h3>‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç!</h3><p>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏µ: ${msg.available_numbers.join(", ")}</p><div style="text-align:left; margin:auto; width:fit-content;">`;
        
        msg.players.forEach(p => {
            html += `<label><b>${p}</b>:</label> <select id="match-${p}"><option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>`;
            msg.available_numbers.forEach(n => html += `<option value="${n}">${n}</option>`);
            html += `</select><br><br>`;
        });
        html += `</div><button onclick="submitLevelGuesses()">Done (‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö)</button>`;
        document.getElementById('game-content').innerHTML = html;
    }

    function submitLevelGuesses() {
        let guesses = {};
        for (let p of currentPlayersToMatch) {
            let val = document.getElementById(`match-${p}`).value;
            if (!val) return alert(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ ${p} ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!`);
            guesses[p] = parseInt(val);
        }
        ws.send(JSON.stringify({ action: "submit_level_guesses", guesses: guesses }));
        document.getElementById('game-content').innerHTML = `<h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö... üìù</h3>`;
    }

    function renderLevelResult(msg) {
        let html = `<h2>üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!</h2><ol style="text-align:left; display:inline-block;">`;
        msg.scores.forEach(s => html += `<li><b>${s.name}</b> ‡∏ó‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å ${s.score} ‡∏Ñ‡∏ô</li>`);
        html += `</ol><hr><h3>‡πÄ‡∏â‡∏•‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á:</h3><ul style="text-align:left; display:inline-block; list-style:none; padding:0;">`;
        
        for (const [pName, num] of Object.entries(msg.actual_numbers)) {
            html += `<li>üëâ <b>${pName}</b> ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç <span style="color:red; font-weight:bold;">${num}</span></li>`;
        }
        html += `</ul><br><button onclick="resetToLobby()">‡∏Å‡∏•‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ</button>`;
        document.getElementById('game-content').innerHTML = html;
    }
</script>

</body>
</html>